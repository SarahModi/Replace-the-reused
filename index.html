<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Replace the Reused</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      scroll-behavior: smooth;
    }

    body {
      background: #0d1117;
      color: #c9d1d9;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    /* HERO SECTION */
    .hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0 20px;
    }

    .hero h1:first-child {
      font-size: clamp(2.5rem, 6vw, 6rem);
      font-weight: 950;
      color: white;
      margin: 0;
    }

    .hero h1.gradient {
      font-size: clamp(2.3rem, 5.5vw, 5.5rem);
      font-weight: 950;
      background: linear-gradient(90deg, #fbbf24, #f97316, #a78bfa, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
    }

    .hero h3 {
      font-size: 1.2rem;
      color: #8b949e;
      font-weight: 400;
      margin-top: 20px;
      margin-bottom: 50px;
      max-width: 600px;
    }

    .scroll-down {
      color: #58a6ff;
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      border: 2px solid #58a6ff;
      padding: 10px 20px;
      border-radius: 50px;
      transition: background 0.3s;
    }

    .scroll-down:hover {
      background: #58a6ff;
      color: #0d1117;
    }

    /* GENERATOR SECTION */
    section {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 100px 20px;
    }

    section h1 {
      color: #58a6ff;
      font-size: 1.8rem;
      margin-bottom: 10px;
      text-align: center;
    }

    .container {
      background: #161b22;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(88,166,255,0.1);
      width: 100%;
      max-width: 420px;
    }

    input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #21262d;
      color: #fff;
      margin-bottom: 15px;
      outline: none;
    }

    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #238636;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #2ea043;
    }

    #resultBox {
      margin-top: 15px;
      display: none;
    }

    #result {
      background: #0d1117;
      padding: 10px;
      border-radius: 8px;
      word-break: break-all;
      font-family: monospace;
      margin-bottom: 5px;
    }

    #strength {
      font-size: 14px;
      color: #8b949e;
    }

    .copy-btn {
      background: #30363d;
      color: #58a6ff;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      float: right;
      margin-bottom: 10px;
    }

    p.note {
      font-size: 12px;
      color: #8b949e;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- HERO -->
  <div class="hero">
    <h1>Replace Your Reused</h1>
    <h1 class="gradient">Passwords</h1>
    <h3>Don’t let one password unlock everything you own.</h3>
    <a href="#generator" class="scroll-down">Scroll to Generator ↓</a>
  </div>

  <!-- GENERATOR SECTION -->
  <section id="generator">
    <h1>Smart Password Generator</h1>
    <div class="container">
      <input type="text" id="userWords" placeholder="Your words (e.g. star, 2030, moon)" />
      <button id="generateBtn">Generate Password</button>
      <div id="resultBox">
        <div id="result"></div>
        <span id="copyBtn" class="copy-btn">Copy</span>
        <div id="strength"></div>
      </div>
      <p class="note">
        All passwords are generated locally. Nothing is stored or shared.
      </p>
    </div>
  </section>

  <script>
    function secureRandomInt(max) {
      const array = new Uint32Array(1);
      crypto.getRandomValues(array);
      return array[0] % max;
    }

    function fisherYatesShuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = secureRandomInt(i + 1);
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function generatePassword(words) {
      const list = words.split(/[\s,]+/).map(w => w.trim()).filter(Boolean);
      if (list.length === 0) return "Please enter some words first.";

      const symbols = ['!', '@', '#', '$', '%', '&', '*'];
      const randomSymbol = symbols[secureRandomInt(symbols.length)];
      const randomNum = secureRandomInt(10000);

      const mixed = list.map(word =>
        word.split('').map(ch => (secureRandomInt(2) ? ch.toUpperCase() : ch)).join('')
      );

      fisherYatesShuffle(mixed);

      let salt = '';
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      for (let i = 0; i < 8; i++) salt += chars[secureRandomInt(chars.length)];

      return mixed.join('') + randomSymbol + randomNum + salt;
    }

    document.getElementById('generateBtn').addEventListener('click', () => {
      const userWords = document.getElementById('userWords').value;
      const password = generatePassword(userWords);
      const resultBox = document.getElementById('resultBox');
      const result = document.getElementById('result');
      const strength = document.getElementById('strength');

      resultBox.style.display = 'block';
      result.textContent = password;

      if (password.startsWith("Please")) {
        strength.textContent = '';
        return;
      }

      try {
        const analysis = typeof zxcvbn === 'function' ? zxcvbn(password) : null;
        if (analysis) {
          strength.innerHTML = `
            <strong>Strength:</strong> ${['Very Weak', 'Weak', 'Fair', 'Strong', 'Very Strong'][analysis.score]}<br>
            Estimated crack time: ${analysis.crack_times_display.offline_fast_hashing_1e10_per_second}
          `;
        } else {
          strength.textContent = 'Strength check unavailable (zxcvbn not loaded).';
        }
      } catch {
        strength.textContent = 'Error analyzing password strength.';
      }
    });

    document.getElementById('copyBtn').addEventListener('click', () => {
      const password = document.getElementById('result').textContent;
      navigator.clipboard.writeText(password).then(() => {
        document.getElementById('copyBtn').textContent = "Copied!";
        setTimeout(() => {
          document.getElementById('copyBtn').textContent = "Copy";
        }, 1500);
      }).catch(() => {
        alert("Could not copy password. Try manually selecting and copying it.");
      });
    });
  </script>

  <!-- VAULT SECTION -->
<section id="vault">
  <h1>Password Vault</h1>
  <div class="container">
    <input type="password" id="masterPassword" placeholder="Enter your vault master password" />
    <input type="text" id="vaultSite" placeholder="Site Name (e.g. example.com)" />
    <input type="text" id="vaultPassword" placeholder="Paste password here" />
    <button id="saveVaultBtn">Save</button>
    <div id="vaultList"></div>
  </div>
</section>

<script>
  // Helper functions for AES-GCM encryption
  async function generateKey(masterPassword) {
    const enc = new TextEncoder();
    const keyMaterial = await crypto.subtle.importKey(
      "raw", enc.encode(masterPassword), "PBKDF2", false, ["deriveKey"]
    );
    return crypto.subtle.deriveKey(
      { name: "PBKDF2", salt: enc.encode("vault-salt"), iterations: 100000, hash: "SHA-256" },
      keyMaterial,
      { name: "AES-GCM", length: 256 },
      false,
      ["encrypt", "decrypt"]
    );
  }

  async function encryptData(data, key) {
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const enc = new TextEncoder();
    const encrypted = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, key, enc.encode(data));
    return { iv: Array.from(iv), data: Array.from(new Uint8Array(encrypted)) };
  }

  async function decryptData(encryptedData, key) {
    const iv = new Uint8Array(encryptedData.iv);
    const data = new Uint8Array(encryptedData.data);
    const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, data);
    return new TextDecoder().decode(decrypted);
  }

  // Vault logic
  async function saveEntry() {
    const masterPassword = document.getElementById('masterPassword').value;
    const site = document.getElementById('vaultSite').value.trim();
    const password = document.getElementById('vaultPassword').value.trim();

    if (!masterPassword || !site || !password) {
      alert("Please fill all fields.");
      return;
    }

    const key = await generateKey(masterPassword);
    const encryptedPassword = await encryptData(password, key);

    let vault = JSON.parse(localStorage.getItem('vault') || '[]');
    vault.push({ site, password: encryptedPassword });
    localStorage.setItem('vault', JSON.stringify(vault));

    document.getElementById('vaultSite').value = '';
    document.getElementById('vaultPassword').value = '';
    renderVault(masterPassword);
  }

  async function renderVault(masterPassword) {
    const vaultDiv = document.getElementById('vaultList');
    vaultDiv.innerHTML = '';

    const vault = JSON.parse(localStorage.getItem('vault') || '[]');
    if (vault.length === 0) {
      vaultDiv.innerHTML = "<p>No saved passwords yet.</p>";
      return;
    }

    const key = await generateKey(masterPassword);

    vault.forEach(async (entry, index) => {
      let decryptedPassword = '';
      try {
        decryptedPassword = await decryptData(entry.password, key);
      } catch {
        decryptedPassword = "Wrong master password";
      }

      const entryDiv = document.createElement('div');
      entryDiv.style.display = 'flex';
      entryDiv.style.justifyContent = 'space-between';
      entryDiv.style.alignItems = 'center';
      entryDiv.style.marginBottom = '10px';
      entryDiv.style.background = '#21262d';
      entryDiv.style.padding = '8px 12px';
      entryDiv.style.borderRadius = '8px';

      const siteSpan = document.createElement('span');
      siteSpan.textContent = entry.site;
      siteSpan.style.color = '#58a6ff';

      const passSpan = document.createElement('span');
      passSpan.textContent = decryptedPassword ? "******" : "";
      passSpan.id = `pass-${index}`;

      const actionsDiv = document.createElement('div');
      actionsDiv.style.display = 'flex';
      actionsDiv.style.gap = '8px';

      const showBtn = document.createElement('button');
      showBtn.textContent = 'Show';
      showBtn.style.background = '#30363d';
      showBtn.style.color = '#58a6ff';
      showBtn.style.padding = '4px 8px';
      showBtn.style.border = 'none';
      showBtn.style.borderRadius = '6px';
      showBtn.style.cursor = 'pointer';
      showBtn.onclick = () => {
        if (passSpan.textContent === "******") {
          passSpan.textContent = decryptedPassword;
          showBtn.textContent = 'Hide';
        } else {
          passSpan.textContent = "******";
          showBtn.textContent = 'Show';
        }
      };

      const copyBtn = document.createElement('button');
      copyBtn.textContent = 'Copy';
      copyBtn.style.background = '#30363d';
      copyBtn.style.color = '#58a6ff';
      copyBtn.style.padding = '4px 8px';
      copyBtn.style.border = 'none';
      copyBtn.style.borderRadius = '6px';
      copyBtn.style.cursor = 'pointer';
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(decryptedPassword).then(() => {
          copyBtn.textContent = "Copied!";
          setTimeout(() => copyBtn.textContent = "Copy", 1500);
        });
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.style.background = '#790000';
      deleteBtn.style.color = '#fff';
      deleteBtn.style.padding = '4px 8px';
      deleteBtn.style.border = 'none';
      deleteBtn.style.borderRadius = '6px';
      deleteBtn.style.cursor = 'pointer';
      deleteBtn.onclick = () => {
        vault.splice(index, 1);
        localStorage.setItem('vault', JSON.stringify(vault));
        renderVault(masterPassword);
      };

      actionsDiv.appendChild(showBtn);
      actionsDiv.appendChild(copyBtn);
      actionsDiv.appendChild(deleteBtn);

      entryDiv.appendChild(siteSpan);
      entryDiv.appendChild(passSpan);
      entryDiv.appendChild(actionsDiv);

      vaultDiv.appendChild(entryDiv);
    });
  }

  document.getElementById('saveVaultBtn').addEventListener('click', saveEntry);
</script>

</body>
</html>
